<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/favicon.ico" />

<title>Connecting to the Yale VPN from Linux&nbsp;|&nbsp;Yash Lala</title>
<meta
  name="title"
  content="Connecting to the Yale VPN from Linux"
/>
<meta
  name="description"
  content="In Fall 2023, Yale made some changes to its VPN login system.
Instead of asking you for your username and password, the VPN client now
directs you to a web-based authentication page.
This causes some trouble when logging in with openconnect. Reaching out to
Yale IT doesn&rsquo;t help here &ndash; they only support Cisco&rsquo;s first-party AnyConnect
client on Windows/Mac.
But there&rsquo;s a workaround. Just tell openconnect to pretend it&rsquo;s a Cisco
client:"
/>
<meta
  name="keywords"
  content=""
/>

  <meta name="author" content="Yash Lala" />




<meta property="og:url" content="https://yashlala.com/blog/2024/yale-vpn-linux/">
  <meta property="og:site_name" content="Yash Lala">
  <meta property="og:title" content="Connecting to the Yale VPN from Linux">
  <meta property="og:description" content="In Fall 2023, Yale made some changes to its VPN login system. Instead of asking you for your username and password, the VPN client now directs you to a web-based authentication page.
This causes some trouble when logging in with openconnect. Reaching out to Yale IT doesn’t help here – they only support Cisco’s first-party AnyConnect client on Windows/Mac.
But there’s a workaround. Just tell openconnect to pretend it’s a Cisco client:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-02-12T17:49:06-07:00">
    <meta property="article:modified_time" content="2024-02-12T17:49:06-07:00">





  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Connecting to the Yale VPN from Linux">
  <meta name="twitter:description" content="In Fall 2023, Yale made some changes to its VPN login system. Instead of asking you for your username and password, the VPN client now directs you to a web-based authentication page.
This causes some trouble when logging in with openconnect. Reaching out to Yale IT doesn’t help here – they only support Cisco’s first-party AnyConnect client on Windows/Mac.
But there’s a workaround. Just tell openconnect to pretend it’s a Cisco client:">





  <meta itemprop="name" content="Connecting to the Yale VPN from Linux">
  <meta itemprop="description" content="In Fall 2023, Yale made some changes to its VPN login system. Instead of asking you for your username and password, the VPN client now directs you to a web-based authentication page.
This causes some trouble when logging in with openconnect. Reaching out to Yale IT doesn’t help here – they only support Cisco’s first-party AnyConnect client on Windows/Mac.
But there’s a workaround. Just tell openconnect to pretend it’s a Cisco client:">
  <meta itemprop="datePublished" content="2024-02-12T17:49:06-07:00">
  <meta itemprop="dateModified" content="2024-02-12T17:49:06-07:00">
  <meta itemprop="wordCount" content="318">
<meta name="referrer" content="no-referrer-when-downgrade" />

    
    
    
    <link href="/bundle.min.css" rel="stylesheet" />

    

    </head>

  <body>
    <header><nav>
  <a
    href="/"
    
    >About Me</a
  >

  <a
    href="/resume.pdf"
    
    >CV</a
  >

  <a
    href="/blog/"
    
    >Blog</a
  >

  <a
    href="/vault/"
    
    >Vault</a
  >

</nav>
    <h1>Connecting to the Yale VPN from Linux</h1>

</header>
    <main>
      
  
  
    
      <p>
        <i>
          <time
            style="color: var(--text-light);"
            datetime="2024-02-12"
            pubdate
          >
            2024-02-12
          </time>
        </i>
      </p>
    
  
  
  <content>
    <p>In Fall 2023, Yale made some changes to its VPN login system.
Instead of asking you for your username and password, the VPN client now
directs you to a web-based authentication page.</p>
<p>This causes some trouble when logging in with <code>openconnect</code>. Reaching out to
Yale IT doesn&rsquo;t help here &ndash; they only support Cisco&rsquo;s first-party AnyConnect
client on Windows/Mac.</p>
<p>But there&rsquo;s a workaround. Just tell <code>openconnect</code> to pretend it&rsquo;s a Cisco
client:</p>






<pre tabindex="0"><code>openconnect --useragent=AnyConnect access.yale.edu</code></pre>
<p>And the VPN will start right up.</p>
<hr>
<p>EDIT: Some readers have had difficulties with the setup process. I&rsquo;ll add
two tips here, so you won&rsquo;t run into the same issues.</p>
<p>Firstly: Your browser will need access to the <code>DISPLAY</code> or <code>WAYLAND_DISPLAY</code>
variables to open a window. <code>sudo</code> won&rsquo;t pass environment variables to
<code>openconnect</code> by default &ndash; so use something like <code>sudo -E openconnect</code>
instead.</p>
<p>Secondly: Running <code>openconnect</code> as root will start your browser as root. This
may put you in a situation where:</p>
<ul>
<li>Your VPN requires root permissions.</li>
<li>Your browser refuses to start with root permissions, for security reasons.</li>
</ul>
<p>Luckily, you can configure the browser that <code>openconnect</code> starts via the
<code>--external-browser</code> flag. So your final command will look something like this:</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>sudo -E /usr/bin/openconnect  --useragent<span style="color:#89dceb;font-weight:bold">=</span>AnyConnect <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#89b4fa"></span>  --external-browser<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#a6e3a1">&#34;</span><span style="color:#f5e0dc">$HOME</span><span style="color:#a6e3a1">/bin/browser-derooting-wrapper-script&#34;</span> <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#89b4fa"></span>  access.yale.edu</span></span></code></pre></div>
<p>If you use Chromium, you can set the <code>browser-derooting-wrapper-script</code> to:</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#6c7086;font-style:italic">#!/bin/sh -e
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#6c7086;font-style:italic"></span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#6c7086;font-style:italic"># Chromium will run as root if the `--no-sandbox` flag is passed. </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#6c7086;font-style:italic"># This is horrendously insecure. So please only use this for the VPN auth</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#6c7086;font-style:italic"># window. </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#89dceb">exec</span> chromium --no-sandbox <span style="color:#a6e3a1">&#34;</span><span style="color:#f5e0dc">$@</span><span style="color:#a6e3a1">&#34;</span></span></span></code></pre></div>
<p>But it&rsquo;s better to set it to something like this:</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#6c7086;font-style:italic">#!/bin/sh -e
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#6c7086;font-style:italic"></span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#6c7086;font-style:italic"># Use `su` to start Firefox as our regular, non-root user. </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#89dceb">exec</span> su --preserve-environment <span style="color:#f5e0dc">$YOUR_USERNAME</span> firefox <span style="color:#a6e3a1">&#34;</span><span style="color:#f5e0dc">$@</span><span style="color:#a6e3a1">&#34;</span></span></span></code></pre></div>
<p>If none of this works &ndash; you can try opening an existing browser window, <em>then</em>
trying the scripts above. <code>openconnect</code> should open a tab in the existing
window, which can sidestep the &ldquo;browser process is root&rdquo; issue.</p>

  </content>
  
    
    
    
    
      <div class="flex-between" style="margin-top: 3rem;">
        
        
          <a href="/blog/2024/gre-materials/" rel="next" aria-label="Next post: Anki flashcards for the GRE Vocab Section">
            <span>Anki flashcards for the GRE Vocab Section</span>
            <span>→</span>
          </a>
        
      </div>
    
  

    </main>
    <footer>
      
  <span>© Yash Lala</span>

<span> 
  |
  <a href="/index.xml">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 448 512">
      
      <path
        d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"
      />
    </svg>
    RSS
  </a>
</span>
<span>
  |
  Made with
  <a href="https://github.com/maolonglong/hugo-simple/">Hugo ʕ•ᴥ•ʔ Simple</a>
</span>

    </footer>
  </body>
</html>
